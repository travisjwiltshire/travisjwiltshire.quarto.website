# netlify.toml
[build]
  command = """
  bash -c '
    set -euo pipefail
    echo "Fetching latest Quarto release version..."
    QUARTO_VERSION=$(curl -s https://api.github.com/repos/quarto-dev/quarto-cli/releases/latest | grep -oE "\"tag_name\": \"v?[0-9.]+\"" | head -n 1 | grep -oE "[0-9.]+")
    echo "Detected Quarto version: ${QUARTO_VERSION}"
    TGZ="quarto-${QUARTO_VERSION}-linux-amd64.tar.gz"
    URL="https://github.com/quarto-dev/quarto-cli/releases/download/v${QUARTO_VERSION}/${TGZ}"
    echo "Installing Quarto ${QUARTO_VERSION} from ${URL}..."
    curl -fsSL -o "${TGZ}" "${URL}"
    tar -xzf "${TGZ}"
    mkdir -p "$HOME/quarto"
    mv "quarto-${QUARTO_VERSION}"/* "$HOME/quarto/"
    export PATH="$HOME/quarto/bin:$PATH"
    quarto --version
    quarto render
  '
  """
  publish = "_site"
